"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[625],{2625:(e,t,a)=>{a.r(t),a.d(t,{default:()=>s});var r=a(5155),n=a(2115),o=a(5695),i=a(8412);let s=e=>{let{children:t}=e,{isAuthenticated:a,isLoading:s}=(0,i.A)(),l=(0,o.useRouter)();return((0,n.useEffect)(()=>{s||a||l.push("/login")},[a,s,l]),s)?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",backgroundColor:"#f5f5f5"},children:(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,r.jsx)("div",{style:{border:"4px solid #f3f3f3",borderTop:"4px solid #3b82f6",borderRadius:"50%",width:"40px",height:"40px",animation:"spin 1s linear infinite",marginBottom:"16px"}}),(0,r.jsx)("p",{children:"Weryfikacja dostępu..."})]})}):a?(0,r.jsx)(r.Fragment,{children:t}):null}},8412:(e,t,a)=>{a.d(t,{A:()=>y});var r=a(2115),n=a(6104),o=a(5317);let i=e=>new TextEncoder().encode(e),s=e=>btoa(String.fromCharCode(...new Uint8Array(e))),l=e=>{let t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a.buffer},c=()=>crypto.getRandomValues(new Uint8Array(16)).buffer,d=async e=>{try{let t=c(),a=await crypto.subtle.importKey("raw",i(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),r=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-256"},a,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=await crypto.subtle.exportKey("raw",r),o=s(n),l=s(t);return{hash:o,salt:l}}catch(e){throw console.error("Błąd podczas haszowania hasła:",e),Error("Nie udało się zahaszować hasła")}},u=async(e,t,a)=>{try{let r=l(a),n=await crypto.subtle.importKey("raw",i(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),o=await crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},n,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),c=await crypto.subtle.exportKey("raw",o);return s(c)===t}catch(e){return console.error("Błąd podczas por\xf3wnywania hasła:",e),!1}},p="packing_app_auth_token";function y(){let[e,t]=(0,r.useState)(!1),[a,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem(p);if(!e){t(!1),i(!1);return}let a=(0,o.H9)(n.db,"settings","password");if((await (0,o.x7)(a)).exists()){let a=e.split("_");if(2===a.length){let e=parseInt(a[1],10);if(Date.now()-e<864e5){t(!0),i(!1);return}}}localStorage.removeItem(p),t(!1)}catch(e){console.error("Błąd podczas weryfikacji autentykacji:",e),t(!1)}finally{i(!1)}})()},[]);let s=async e=>{try{i(!0);let{hash:a,salt:r}=await d(e),s=(0,o.H9)(n.db,"settings","password");await (0,o.BN)(s,{hash:a,salt:r,updatedAt:new Date});let l="auth_".concat(Date.now());return localStorage.setItem(p,l),t(!0),!0}catch(e){return console.error("Błąd podczas ustawiania hasła:",e),!1}finally{i(!1)}};return{isAuthenticated:e,isLoading:a,login:async e=>{try{i(!0);let a=(0,o.H9)(n.db,"settings","password"),r=await (0,o.x7)(a);if(!r.exists())return await s(e),!0;let{hash:l,salt:c}=r.data();if(await u(e,l,c)){let e="auth_".concat(Date.now());return localStorage.setItem(p,e),t(!0),!0}return!1}catch(e){return console.error("Błąd podczas logowania:",e),!1}finally{i(!1)}},logout:()=>{localStorage.removeItem(p),t(!1)},setPassword:s}}}}]);