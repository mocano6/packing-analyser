(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[520],{68:e=>{e.exports={loginContainer:"login_loginContainer__UoJWl",loginCard:"login_loginCard__oUnJN",loginTitle:"login_loginTitle__pqjEI",loginForm:"login_loginForm__pGvdf",formGroup:"login_formGroup__exBI3",input:"login_input__GK8Qo",loginButton:"login_loginButton__ZAuNC",errorMessage:"login_errorMessage____0Gr",infoBox:"login_infoBox__uVmuL",loadingContainer:"login_loadingContainer__Pm6zQ",redirectContainer:"login_redirectContainer__5jEJm",loadingSpinner:"login_loadingSpinner__0Mb_h",spin:"login_spin__7YwG_"}},5695:(e,a,t)=>{"use strict";var r=t(8999);t.o(r,"usePathname")&&t.d(a,{usePathname:function(){return r.usePathname}}),t.o(r,"useRouter")&&t.d(a,{useRouter:function(){return r.useRouter}})},6104:(e,a,t)=>{"use strict";t.d(a,{db:()=>l});var r=t(3915),o=t(5317),n=t(6203),s=t(858);let i=(0,r.Dk)().length>0?(0,r.Sx)():(0,r.Wp)({apiKey:"AIzaSyB6O68_OME3BE3kDEBTNbTcGCKDUrghuJ0",authDomain:"rakow-academy.firebaseapp.com",projectId:"rakow-academy",storageBucket:"rakow-academy.firebasestorage.app",messagingSenderId:"13314435269",appId:"1:13314435269:web:652465d1c608868dca28ac"}),l=(0,o.aU)(i),c=async()=>{try{await (0,o.Q5)(l),console.log("Persistencja dla wielu zakładek włączona pomyślnie")}catch(e){"failed-precondition"===e.code?console.warn("Persistencja offline nie może być włączona - aplikacja jest otwarta w wielu kartach."):"unimplemented"===e.code?console.warn("Persistencja offline nie jest dostępna w tej przeglądarce."):console.error("Błąd przy włączaniu persistencji offline:",e)}};setTimeout(()=>{c()},1e3),(0,n.xI)(i),(0,s.c7)(i)},8037:(e,a,t)=>{Promise.resolve().then(t.bind(t,9690))},8412:(e,a,t)=>{"use strict";t.d(a,{A:()=>w});var r=t(2115),o=t(6104),n=t(5317);let s=e=>new TextEncoder().encode(e),i=e=>btoa(String.fromCharCode(...new Uint8Array(e))),l=e=>{let a=atob(e),t=new Uint8Array(a.length);for(let e=0;e<a.length;e++)t[e]=a.charCodeAt(e);return t.buffer},c=()=>crypto.getRandomValues(new Uint8Array(16)).buffer,d=async e=>{try{let a=c(),t=await crypto.subtle.importKey("raw",s(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),r=await crypto.subtle.deriveKey({name:"PBKDF2",salt:a,iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),o=await crypto.subtle.exportKey("raw",r),n=i(o),l=i(a);return{hash:n,salt:l}}catch(e){throw console.error("Błąd podczas haszowania hasła:",e),Error("Nie udało się zahaszować hasła")}},u=async(e,a,t)=>{try{let r=l(t),o=await crypto.subtle.importKey("raw",s(e),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]),n=await crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:1e5,hash:"SHA-256"},o,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),c=await crypto.subtle.exportKey("raw",n);return i(c)===a}catch(e){return console.error("Błąd podczas por\xf3wnywania hasła:",e),!1}},p="packing_app_auth_token";function w(){let[e,a]=(0,r.useState)(!1),[t,s]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem(p);if(!e){a(!1),s(!1);return}let t=(0,n.H9)(o.db,"settings","password");if((await (0,n.x7)(t)).exists()){let t=e.split("_");if(2===t.length){let e=parseInt(t[1],10);if(Date.now()-e<864e5){a(!0),s(!1);return}}}localStorage.removeItem(p),a(!1)}catch(e){console.error("Błąd podczas weryfikacji autentykacji:",e),a(!1)}finally{s(!1)}})()},[]);let i=async e=>{try{s(!0);let{hash:t,salt:r}=await d(e),i=(0,n.H9)(o.db,"settings","password");await (0,n.BN)(i,{hash:t,salt:r,updatedAt:new Date});let l="auth_".concat(Date.now());return localStorage.setItem(p,l),a(!0),!0}catch(e){return console.error("Błąd podczas ustawiania hasła:",e),!1}finally{s(!1)}};return{isAuthenticated:e,isLoading:t,login:async e=>{try{s(!0);let t=(0,n.H9)(o.db,"settings","password"),r=await (0,n.x7)(t);if(!r.exists())return await i(e),!0;let{hash:l,salt:c}=r.data();if(await u(e,l,c)){let e="auth_".concat(Date.now());return localStorage.setItem(p,e),a(!0),!0}return!1}catch(e){return console.error("Błąd podczas logowania:",e),!1}finally{s(!1)}},logout:()=>{localStorage.removeItem(p),a(!1)},setPassword:i}}},9690:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var r=t(5155),o=t(2115),n=t(5695),s=t(8412),i=t(68),l=t.n(i),c=t(5317),d=t(6104);function u(){let[e,a]=(0,o.useState)(""),[t,i]=(0,o.useState)(null),[u,p]=(0,o.useState)(!1),[w,h]=(0,o.useState)(""),[g,m]=(0,o.useState)(!1),y=(0,n.useRouter)(),{isAuthenticated:_,isLoading:f,login:j,setPassword:x}=(0,s.A)();(0,o.useEffect)(()=>{_&&!f&&y.push("/")},[_,f,y]);let b=async()=>{try{let e=(0,c.H9)(d.db,"settings","password"),a=await (0,c.x7)(e);p(!a.exists())}catch(e){console.error("Błąd podczas sprawdzania statusu hasła:",e),p(!1)}};(0,o.useEffect)(()=>{b()},[]);let z=async a=>{a.preventDefault(),i(null),m(!0);try{if(u){if(e!==w){i("Hasła nie są identyczne"),m(!1);return}await x(e)?y.push("/"):i("Nie udało się ustawić hasła")}else await j(e)?y.push("/"):i("Nieprawidłowe hasło")}catch(e){console.error("Błąd podczas logowania:",e),i("Wystąpił błąd podczas logowania")}finally{m(!1)}};return f?(0,r.jsxs)("div",{className:l().loadingContainer,children:[(0,r.jsx)("div",{className:l().loadingSpinner}),(0,r.jsx)("p",{children:"Ładowanie..."})]}):_?(0,r.jsx)("div",{className:l().redirectContainer,children:(0,r.jsx)("p",{children:"Jesteś już zalogowany. Przekierowywanie..."})}):(0,r.jsx)("div",{className:l().loginContainer,children:(0,r.jsxs)("div",{className:l().loginCard,children:[(0,r.jsx)("h1",{className:l().loginTitle,children:u?"Ustaw hasło aplikacji":"Logowanie do aplikacji"}),u&&(0,r.jsx)("div",{className:l().infoBox,children:(0,r.jsx)("p",{children:"To pierwsze logowanie do aplikacji. Ustaw hasło, kt\xf3re będzie używane przez wszystkich użytkownik\xf3w."})}),(0,r.jsxs)("form",{onSubmit:z,className:l().loginForm,children:[(0,r.jsxs)("div",{className:l().formGroup,children:[(0,r.jsx)("label",{htmlFor:"password",children:"Hasło"}),(0,r.jsx)("input",{type:"password",id:"password",value:e,onChange:e=>a(e.target.value),required:!0,minLength:6,className:l().input,placeholder:"Wprowadź hasło"})]}),u&&(0,r.jsxs)("div",{className:l().formGroup,children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",children:"Potwierdź hasło"}),(0,r.jsx)("input",{type:"password",id:"confirmPassword",value:w,onChange:e=>h(e.target.value),required:!0,minLength:6,className:l().input,placeholder:"Potwierdź hasło"})]}),t&&(0,r.jsx)("div",{className:l().errorMessage,children:t}),(0,r.jsx)("button",{type:"submit",className:l().loginButton,disabled:g,children:g?"Przetwarzanie...":u?"Ustaw hasło":"Zaloguj się"})]})]})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[471,992,158,288,441,684,358],()=>a(8037)),_N_E=e.O()}]);